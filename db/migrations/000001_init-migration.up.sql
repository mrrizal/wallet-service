CREATE TYPE "wallet_status" AS ENUM (
  'enabled',
  'disabled'
);

CREATE TYPE "transaction_status" AS ENUM (
  'success',
  'failed'
);

CREATE TYPE "transaction_type" AS ENUM (
  'withdrawal',
  'deposit'
);

CREATE TABLE "user_token" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "user_id" VARCHAR(36) UNIQUE,
  "token" VARCHAR(42) UNIQUE,
  "created_at" timestamp DEFAULT (now())
);

CREATE TABLE "wallet" (
  "id" VARCHAR(36) PRIMARY KEY,
  "user_id" VARCHAR(36) UNIQUE,
  "status" wallet_status,
  "enabled_at" timestamp,
  "balance" float
);

CREATE TABLE "transactions" (
  "id" VARCHAR(36) PRIMARY KEY,
  "wallet_id" VARCHAR(36),
  "status" transaction_status,
  "transacted_at" timestamp DEFAULT (now()),
  "type" transaction_type,
  "amount" float,
  "reference_id" VARCHAR(36)
);

CREATE UNIQUE INDEX ON "wallet" ("id", "user_id");

ALTER TABLE "wallet" ADD FOREIGN KEY ("user_id") REFERENCES "user_token" ("user_id");

ALTER TABLE "transactions" ADD FOREIGN KEY ("wallet_id") REFERENCES "wallet" ("id");
